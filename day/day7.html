<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>LÃ¥ge 7 â€“ Sorter julegaver</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #204226;
  margin: 0;
  padding: 0;
  text-align: center;
  color: white;
}
h1 {
  font-size: 24px;
  margin: 20px 0;
}
.content-box {
  background-color: white;
  color: black;
  padding: 20px;
  border-radius: 12px;
  max-width: 500px;
  width: 90%;
  margin: 20px auto;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  position: relative;
}
#gameArea {
  position: relative;
  width: 100%;
  padding-top: 100%; /* kvadratisk spilomrÃ¥de */
  margin: 0 auto 20px auto;
  overflow: hidden;
}
#backgroundBack, #backgroundFront {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  object-fit: contain;
}
.gift {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 2;
  width: 50px;
  height: 50px;
}
.sack {
  position: absolute;
  bottom: 10px;
  width: 20%;
  max-width: 80px;
  cursor: pointer;
  z-index: 4;
}
#sackBlÃ¥ { left: 0; }
#sackRÃ¸d { left: 25%; }
#sackGul { left: 50%; }
#sackGrÃ¸n { left: 75%; }
#scoreDisplay {
  margin-top: 10px;
  font-weight: bold;
}
#endScreen {
  display: none;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #204226;
  color: white;
  padding: 15px 20px;
  border-radius: 8px;
  font-weight: bold;
  z-index: 10;
}
.back-button {
  display: inline-block;
  margin-top: 20px;
  padding: 10px 16px;
  background-color: #204226;
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-weight: bold;
}
.back-button:hover {
  background-color: #35663c;
}

@media (max-width: 600px) {
  h1 { font-size: 20px; }
  .gift { width: 30px; height: 30px; }
  .sack { max-width: 60px; }
}
</style>
</head>
<body>

<h1>GlÃ¦delig 7. december â€“ Sorter julegaverne!</h1>

<div class="content-box">
  <div id="gameArea">
    <img id="backgroundBack" src="../assets/sorterMaskineBag.svg" alt="Baggrund bag">
    
    <img id="backgroundFront" src="../assets/sorterMaskineFront.svg" alt="Maskine front">

    <img id="sackBlÃ¥" class="sack" src="../assets/sorterBlÃ¥SÃ¦k.svg" alt="BlÃ¥ sÃ¦k">
    <img id="sackRÃ¸d" class="sack" src="../assets/sorterRÃ¸dSÃ¦k.svg" alt="RÃ¸d sÃ¦k">
    <img id="sackGul" class="sack" src="../assets/sorterGulSÃ¦k.svg" alt="Gul sÃ¦k">
    <img id="sackGrÃ¸n" class="sack" src="../assets/sorterGrÃ¸nSÃ¦k.svg" alt="GrÃ¸n sÃ¦k">

    <div id="endScreen"></div>
  </div>

  <div id="scoreDisplay">Sorterede gaver: 0</div>

  <p><a href="../index.html" class="back-button">â¬… Tilbage til kalenderen</a></p>
</div>

<script>
const gameArea = document.getElementById("gameArea");
const scoreDisplay = document.getElementById("scoreDisplay");
const endScreen = document.getElementById("endScreen");

const sackMap = {
  blÃ¥: document.getElementById("sackBlÃ¥"),
  rÃ¸d: document.getElementById("sackRÃ¸d"),
  gul: document.getElementById("sackGul"),
  grÃ¸n: document.getElementById("sackGrÃ¸n")
};

const colors = ["blÃ¥","rÃ¸d","gul","grÃ¸n"];
const giftCounts = 4;
let giftsQueue = [];
let activeGifts = [];
let score = 0;

// Opret queue af gaver
colors.forEach(color => {
  for (let i=1; i<=giftCounts; i++) {
    giftsQueue.push({
      src: `../assets/sorter${color.charAt(0).toUpperCase()+color.slice(1)}${i}.svg`,
      color: color,
      caught: false
    });
  }
});
giftsQueue.sort(()=>Math.random()-0.5);

function spawnNextGift() {
  if (giftsQueue.length === 0) return;

  const giftData = giftsQueue.shift();
  const gift = document.createElement("img");
  gift.src = giftData.src;
  gift.classList.add("gift");
  gift.dataset.color = giftData.color;
  gift.dataset.caught = "false";
  gift.style.left = "-50px";
  gameArea.appendChild(gift);
  activeGifts.push(gift);

  moveGift(gift);

  if (giftsQueue.length > 0) setTimeout(spawnNextGift, 1000);
}

function moveGift(gift) {
  function step() {
    if (gift.dataset.caught === "false") {
      let left = parseFloat(gift.style.left);
      left += 2;
      gift.style.left = left + "px";

      if (left > gameArea.offsetWidth) {
        gift.dataset.caught = "missed";
        gift.remove();
        activeGifts = activeGifts.filter(g=>g!==gift);
        checkEndGame();
        return;
      }
      requestAnimationFrame(step);
    }
  }
  requestAnimationFrame(step);
}

Object.keys(sackMap).forEach(color => {
  sackMap[color].addEventListener("click", () => {
    if (activeGifts.length === 0) return;
    let rightmost = activeGifts.reduce((maxGift, g) => 
      parseFloat(g.style.left) > parseFloat(maxGift.style.left) ? g : maxGift
    , activeGifts[0]);

    if (rightmost.dataset.color === color) score++;
    rightmost.dataset.caught = "true";
    rightmost.remove();
    activeGifts = activeGifts.filter(g=>g!==rightmost);
    scoreDisplay.textContent = `Sorterede gaver: ${score}`;
    checkEndGame();
  });
});

function checkEndGame() {
  if (activeGifts.length === 0 && giftsQueue.length === 0) {
    endScreen.style.display = "block";
    endScreen.textContent = `ðŸŽ‰ Tillykke! Du sorterede ${score} gaver! ðŸŽ‰`;
  }
}

spawnNextGift();
</script>

</body>
</html>
